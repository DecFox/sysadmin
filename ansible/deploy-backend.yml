---
- import_playbook: ansible-version.yml

- hosts: ams-pg.ooni.org
  roles:
    - role: base-buster
    - role: nftables
    - role: nginx-buster
      tags: nginx
    - role: letsencrypt
      tags: letsencrypt
      expand: yes
      letsencrypt_domains:
        - "ams-pg.ooni.org"
        - "api.ooni.io"
        - "collector.ooni.io"
        - "a.collector.ooni.io"
        - "b.collector.ooni.io"
        - "c.collector.ooni.io"
        - "ps.ooni.io"
        - "ps1.ooni.io"
        - "ps2.ooni.io"
        - "ps3.ooni.io"
        - "ps4.ooni.io"
    - role: ooni-backend
      ssl_domain: ams-pg.ooni.org

- hosts: ams-pg-test.ooni.org
  roles:
    - role: base-buster
    - role: nftables
    - role: nginx-buster
      tags: nginx
    - role: letsencrypt
      tags: letsencrypt
      expand: yes
      letsencrypt_domains:
        - "ams-pg-test.ooni.org"
    - role: ooni-backend
      ssl_domain: ams-pg.ooni.org

- hosts: test-helper.ooni.org
  roles:
    - role: base-buster
    - role: nftables
    - role: docker
    - role: letsencrypt
      letsencrypt_domains:
        - "test-helper.ooni.org"
    - role: th-web-connectivity
      tags: wcth
      web_connectivity_domain: test-helper.ooni.org
