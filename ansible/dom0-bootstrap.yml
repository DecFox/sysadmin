---
- include: ansible-version.yml

- hosts: gh:!no_passwd # TODO: it eventually should become `all`
  become: false
  remote_user: root
  gather_facts: false
  # That's usually not required on GH images, but really minimal image like
  # docker's `debian:jessie` does not contain python and needs bootstrap.
  #pre_tasks:
  #  - name: bootstap python
  #    raw: if [ ! -x /usr/bin/python ]; then apt-get update && apt-get -y install python-simplejson python-apt; fi
  #    register: output
  #    changed_when: output.stdout != ""
  roles:
    - role: adm

- hosts: gh:!no_passwd
  gather_facts: false
  roles:
    # every known UID should be reserved to avoid occasional clash with `useradd`
    - role: passwd

- hosts: have_fw
  gather_facts: false
  roles:
    - role: fw

- hosts: monitored
  gather_facts: false
  roles:
    - role: nginx-prometheus
    - role: node_exporter
